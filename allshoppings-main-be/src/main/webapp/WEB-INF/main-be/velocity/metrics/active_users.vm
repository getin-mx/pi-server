<script type="text/javascript">

$(function() {
	var seriesOptions = [],
		yAxisOptions = [],
		seriesCounter = 0,
		names = ['', 'male', 'female'],
		colors = Highcharts.getOptions().colors;

		$.each(names, function(i, name) {
	
			$.getJSON('/main-be/metrics/timelineData?metricEntity=User&metricType=2&filter=' + (name == '' ? name : 'gender=' + name) + '&callback=?', function(data) {
	
				var myName;
				if( name == '') {
					myName = $.i18n._('counters.activeusers.total');
				} else {
					myName = $.i18n._('counters.activeusers.' + name);
				}
				
				seriesOptions[i] = {
					name: myName,
					data: data
				};
	
				// As we're loading the data asynchronously, we don't know what order it will arrive. So
				// we keep a counter and create the chart when all the data is loaded.
				seriesCounter++;
	
				if (seriesCounter == names.length) {
					createChart();
				}
			});
		});



	// create the chart when all data is loaded
	function createChart() {

		$('#active_users_widget_container').highcharts('StockChart', {
			lang : {
				contextButtonTitle : 'Menu',
				decimalPoint : '.',
				downloadJPEG : 'Descargar JPEG',
				downloadPDF : 'Descargar PDF',
				downloadPNG : 'Descargar PNG',
				downloadSVG : 'Descargar SVG',
				loading : 'Cargando...',
				months : ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
				printChart : 'Imprimir',
				rangeSelectorFrom : 'Desde',
				rangeSelectorTo : 'Hasta',
				rangeSelectorZoom : 'Zoom',
				resetZoom : 'Reestablecer Zoom',
				resetZoomTitle : 'Zoom 1:1',
				thousandsSep : ',',
				weekdays : ['Domingo', 'Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes', 'Sabado']
			},

			title : {
				text : $.i18n._('counters.activeusers.title')
			},

			chart: {
		    },

		    rangeSelector: {
		        selected: 1
		    },

		    tooltip: {
		    	pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b><br/>',
		    	valueDecimals: 0
		    },
		    
		    series: seriesOptions
		});
	}

});
</script>


<div class="widget" id="active_users_widget" data-icon="users" data-collapsed="false" data-collapsible="false">
	<h3 class="handle">#springMessage("counters.activeusers.title")</h3>
	<div>
		<div id="active_users_widget_container" style="height: 400px; min-width: 400px"></div>
	</div>
</div>
