#parse("/includes/macros.vm")
<!doctype html>
<html lang="en-us">
<head>
	<meta charset="utf-8">
#if( $userProfile )
	<title>#springMessage("app.title") | #springMessage("app.user.edit")</title>
#else
	<title>#springMessage("app.title") | #springMessage("app.user")</title>
#end

	<meta name="description" content='#springMessage("app.user.description")'>
	<meta name="author" content='#springMessage("app.url")'>

	<script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=true"></script>
	<script type="text/javascript" src="/main-be/js/gmaps.js"></script>

#parse("includes/header.vm")

	<!-- local functionality script -->
	<script src="/main-be/js/user.js"></script>

	#if( $canwrite == false )
	<script>
		$(document).ready(function() {
			$.setReadOnly();
		});
	</script>
	#end
</head>
<body>
#parse("includes/topmenu.vm")
#parse("includes/leftmenu.vm")
	<!-- content -->
	<section id="content">
		<ul id="headbreadcrumb" class="breadcrumb" data-connect="breadcrumbcontent">
			<li><a href="#">#springMessage("app.user.personalData")</a></li>
			#if( $userProfile )
			<li><a href="#">#springMessage("app.user.location")</a></li>
			<li><a href="#">#springMessage("app.user.messaging")</a></li>
			<li><a href="#">#springMessage("app.user.devices")</a></li>
			<li><a href="#">#springMessage("app.user.notifications")</a></li>
			<li><a href="#">#springMessage("app.user.permissions")</a></li>
			<li><a href="#">#springMessage("app.audit")</a></li>
			<li><a id="bcLastLocation" href="#">#springMessage("app.user.lastLocation")</a></li>
			#end
		</ul>

		<div class="g12 nodrop">
			<table>
				<tr>
					<td width="110">
					#if( $userProfile.AvatarId )
						<a class="fancybox" href="/img/$!userProfile.AvatarId" title="$!userProfile.Fullname"><img src="/img/$!userProfile.AvatarId" width="100" height="100" alt=""></a>
					#else
						<a class="fancybox" href="/main-be/css/images/defaultavatar.png"><img src="/main-be/css/images/defaultavatar.png" width="100" height="100" alt=""></a>
					#end
					</td>
					<td style="text-align: left;">
						<div class="g12 nodrop">
						#if( $userProfile )
							<h1>#springMessage("app.user.edit")</h1>
						#else
							<h1>#springMessage("app.user")</h1>
						#end
							<p>#springMessage("app.user.description")</p>
						</div>
					</td>
				</tr>
			</table>
		</div>
		<div>
			<div id="breadcrumbcontent">
				<!-- Personal Profile -->
				<div>
					<form id="contactForm" method="post" action="doUpdateUser" autocomplete="off">
						<fieldset>
							<label style="height: 30px;">
								#springMessage("app.user.personalData")
								#if( $canwrite == true )
									<button class="fr submit">#springMessage("app.button.submit")</button>
								#else
									<button class="fr" onclick="window.location='/main-be/userList';" >#springMessage("app.button.back")</button>
								#end
							</label>

							<section>
								<label>#springMessage("data.userName")</label>
								<div>
								#if ($userProfile)
									<div>$userProfile.Identifier</div>
									<input type="hidden" id="userid" value="$userProfile.Identifier">
									<input type="hidden" id="crudtype" value="edit">
								#else
									<input style="width: 97% !important;" type="text" id="userid" required data-errortext='#springMessage("error.userid")'>
									<input type="hidden" id="crudtype" value="create">
								#end
								</div>
							</section>

							<section>
								<label>#springMessage("data.fullName")</label>
								<div>
									<input style="width: 48% !important;" type="text" id="firstname" required
										data-errortext='#springMessage("error.username")'  
										value="$!userProfile.Firstname">
									<input style="width: 48% !important;" type="text" id="lastname"
										value="$!userProfile.Lastname">
								</div>
							</section>

							<section>
								<label>#springMessage("data.password")</label>
								<div>
									<input type="password" id="password"
										data-errortext='#springMessage("error.password")'
										value="$!userProfile.securitySettings.password">
								</div>
							</section>

							<section>
								<label>#springMessage("data.email")</label>
								<div>
									<input style="width: 97% !important;" type="email" id="mail" required 
										data-errortext='#springMessage("error.useremail")'
										value="$!userProfile.ContactInfo.Mail.Email">
								</div>
							</section>

							<section>
								<label>#springMessage("data.phoneAndMobile")</label>
								<div>
									<input style="width: 48% !important;" type="text" id="phone" value="$!userProfile.ContactInfo.Phone">
									<input style="width: 48% !important;" type="text" id="mobile" value="$!userProfile.ContactInfo.Mobile">
								</div>
							</section>

							<section>
								<label for="avatar">#springMessage("data.avatar")</label>
								<div>
									<table>
										<tr>
											<td width="130" style="vertical-align: middle;">
											#if( $userProfile.AvatarId )
												<a id="avatarAnchor" class="fancybox" href="/img/$!userProfile.AvatarId" title="$!userProfile.Fullname"><img id="avatarImage" src="/img/$!userProfile.AvatarId" width="116" height="116" alt=""></a>
											#else
												<a id="avatarAnchor" class="fancybox" href="/main-be/css/images/defaultavatar.png" title=""><img id="avatarImage" src="/main-be/css/images/defaultavatar.png" width="116" height="116" alt=""></a>
											#end
											<input type="hidden" id="avatarId"/>
											</td>
											<td>
												<input type="file" id="avatar">
											</td>
										</tr>
									</table>
								</div>
							</section>

							<section>
								<label>#springMessage("data.gender")</label>
								<div>
									#select("gender", $userProfile.Gender, $svh.getGenderNames(${lang}), $svh.GenderValues)
								</div>
							</section>

							<section>
								<label for="birthDate">#springMessage("data.birthdate")</label>
								<div>
									<input id="birthDay" type="text" maxlength="2" style="width: 30px;" value="#getday($userProfile.birthDate)" data-regex="^[0-9 ]+$" data-errortext='#springMessage("error.onlyNumbers")'>
									#select("birthMonth", "#getmonth($userProfile.birthDate)", $svh.getMonthNames(${lang}), $svh.MonthValues)
									<input id="birthYear" type="text" maxlength="4" style="width: 50px;" value="#getyear($userProfile.birthDate)" data-regex="^[0-9 ]+$" data-errortext='#springMessage("error.onlyNumbers")'>
								</div>
							</section>

							<label>#springMessage("app.profile.additionalData")</label>

							<section>
								<label>#springMessage("data.webpage")</label>
								<div>
									<input style="width: 97% !important;" type="text" id="webURL"  placeholder="http://" value="$!userProfile.ContactInfo.WebURL">
								</div>
							</section>

							<section>
								<label>#springMessage("data.facebook")</label>
								<div>
									<input style="width: 97% !important;" type="text" id="facebookId" value="$!userProfile.ContactInfo.FacebookId">
								</div>
							</section>

							<section>
								<label>#springMessage("data.twitter")</label>
								<div>
									<input style="width: 97% !important;" type="text" id="twitterId" value="$!userProfile.ContactInfo.TwitterId">
								</div>
							</section>

							<section>
								<label>#springMessage("data.googleId")</label>
								<div>
									<input style="width: 97% !important;" type="text" id="googleId" value="$!userProfile.ContactInfo.GoogleId">
								</div>
							</section>

							<section>
								<label>#springMessage("data.foursquareId")</label>
								<div>
									<input style="width: 97% !important;" type="text" id="foursquareId" value="$!userProfile.ContactInfo.FoursquareId">
								</div>
							</section>

							<section>
								<label>#springMessage("data.youtubeChannel")</label>
								<div>
									<input style="width: 97% !important;" type="text" id="youtubeChannel" value="$!userProfile.ContactInfo.YoutubeChannel">
								</div>
							</section>

							<section>
								<div>
								#if( $canwrite == true )
									<button class="fr submit">#springMessage("app.button.submit")</button>
								#else
									<button class="fr" onclick="window.location='/main-be/userList';" >#springMessage("app.button.back")</button>
								#end
								</div>
							</section>

							<section>
								<div id="contactFormMsg"></div>
							</section>

						</fieldset>
					</form>
				</div>

				#if( $userProfile )
				<!-- Location -->
				<div>
					<form id="locationForm" method="post" action="doUpdateUserLocation" autocomplete="off">
						<fieldset>
							<input type="hidden" id="userid" value="$userProfile.Identifier">
							<label style="height: 30px;">
								#springMessage("app.profile.location")
								#if( $canwrite == true )
									<button class="fr submit">#springMessage("app.button.submit")</button>
								#else
									<button class="fr" onclick="window.location='/main-be/userList';" >#springMessage("app.button.back")</button>
								#end
							</label>

							<section>
								<label>#springMessage("data.addressAndNumber")</label>
								<div>
									<input style="width: 48% !important;" type="text" id="streetName" value="$!userProfile.Address.StreetName">
									<input style="width: 48% !important;" type="text" id="streetNumber" value="$!userProfile.Address.StreetNumber">
								</div>
							</section>

							<section>
								<label>#springMessage("data.citiAndZipCode")</label>
								<div>
									<input style="width: 48% !important;" type="text" id="city" value="$!userProfile.Address.City">
									<input style="width: 48% !important;" type="text" id="zipCode" value="$!userProfile.Address.ZipCode">
								</div>
							</section>

							<section>
								<label>#springMessage("data.province")</label>
								<div>
									<input style="width: 97% !important;" type="text" id="province" value="$!userProfile.Address.Province">
								</div>
							</section>

							<section>
								<label>#springMessage("data.country")</label>
								<div>
									#select("country", $!userProfile.Address.Country, $svh.getCountryNames(${lang}), $svh.getCountryNames(${lang}))
								</div>
							</section>

							<section>
								<label>#springMessage("data.currentCountry")</label>
								<div>
									#select("currentCountry", $!userProfile.ViewLocation.Country, $svh.getCountryNames(${lang}), $svh.getCountryNames(${lang}))
								</div>
							</section>

							<section>
								<div>
								#if( $canwrite == true )
									<button class="fr submit">#springMessage("app.button.submit")</button>
								#else
									<button class="fr" onclick="window.location='/main-be/userList';" >#springMessage("app.button.back")</button>
								#end
								</div>
							</section>

							<section>
								<div id="locationFormMsg"></div>
							</section>
							
						</fieldset>
					</form>
				</div>

				<!-- Messaging options -->
				<div>
					<form id="messagingForm" method="post" action="doUpdateUserMessaging" autocomplete="off">
						<fieldset>
							<input type="hidden" id="userid" value="$userProfile.Identifier">
							<label style="height: 30px;">
								#springMessage("app.user.messaging")
								#if( $canwrite == true )
									<button class="fr submit">#springMessage("app.button.submit")</button>
								#else
									<button class="fr" onclick="window.location='/main-be/userList';" >#springMessage("app.button.back")</button>
								#end
							</label>

							<section>
								<label>#springMessage("data.receivePushMessages")</label>
								<div>
									#select("receivePushMessages", $!userProfile.ReceivePushMessages, $svh.getBooleanNames(${lang}), $svh.BooleanValues)
								</div>
							</section>

							<section>
								<label>#springMessage("data.geoFenceEnabled")</label>
								<div>
									#select("geoFenceEnabled", $!userProfile.GeoFenceEnabled, $svh.getBooleanNames(${lang}), $svh.BooleanValues)
								</div>
							</section>

							<section>
								<div>
								#if( $canwrite == true )
									<button class="fr submit">#springMessage("app.button.submit")</button>
								#else
									<button class="fr" onclick="window.location='/main-be/userList';" >#springMessage("app.button.back")</button>
								#end
								</div>
							</section>

							<section>
								<div id="messagingFormMsg"></div>
							</section>

						</fieldset>
					</form>
				</div>

				<!-- Devices -->
				<div>
					<div class="g12 nodrop">
						<h1>#springMessage("app.user.devices")</h1>
					</div>
					<table id="userDevices" class="datatable">
						<thead>
							<tr>
								<th>#springMessage("app.user.deviceName")</th>
								<th>#springMessage("app.user.devicePlatform")</th>
								<th>#springMessage("app.user.deviceVersion")</th>
								<th>#springMessage("app.user.appVersion")</th>
								<th>#springMessage("app.user.status")</th>
								<th>#springMessage("app.user.creationDateTime")</th>
								<th>#springMessage("app.user.lastUpdate")</th>
								<th width="90">#springMessage("app.table.actions")</th>
							</tr>
						</thead>
						<tbody>
							<tr class="gradeX">
							</tr>
						</tbody>
					</table>
				</div>

				<!-- Notifications -->
				<div>
					<div class="g12 nodrop">
						<h1>#springMessage("app.user.notifications")</h1>
					</div>
					<table id="userDeliveredMessages" class="datatable">
						<thead>
							<tr>
								<th>#springMessage("data.entity")</th>
								<th>#springMessage("data.kind")</th>
								<th>#springMessage("data.notifyDate")</th>
								<th>#springMessage("data.receivedDate")</th>
							</tr>
						</thead>
						<tbody>
							<tr class="gradeX">
							</tr>
						</tbody>
					</table>
				</div>

				<!-- Permissions -->
				<div>
					<form id="permissionsForm" method="post" action="doUpdateUserPermissions" autocomplete="off">
						<fieldset>
							<input type="hidden" id="userid" value="$userProfile.Identifier">
							<label style="height: 30px;">
								#springMessage("app.user.permissions")
								#if( $canwrite == true )
									<button class="fr submit">#springMessage("app.button.submit")</button>
								#else
									<button class="fr" onclick="window.location='/main-be/userList';" >#springMessage("app.button.back")</button>
								#end
							</label>

							<section>
								<label>#springMessage("data.role")</label>
								<div>
									#select("role", $!userProfile.SecuritySettings.Role,  $svh.getRoleNames(${lang}), $svh.RoleValues)
								</div>
							</section>

							<section id='availableCountriesSection' style="display: none;">
								<label>#springMessage("data.availableCountries")</label>
								<div>
									#multiselect("availableCountries", $!userProfile.SecuritySettings.AvailableCountries, $availableCountryNames, $availableCountryIds)
								</div>
							</section>

							<section id='shoppingsSection' style="display: none;">
								<label>#springMessage("data.shopping")</label>
								<div>
									#multiselect("shoppings", $!userProfile.SecuritySettings.Shoppings, $shoppingNames, $shoppingIds)
								</div>
							</section>

							<section id='brandsSection' style="display: none;">
								<label>#springMessage("data.brand")</label>
								<div>
									#multiselect("brands", $!userProfile.SecuritySettings.Brands, $brandNames, $brandIds)
								</div>
							</section>

							<section id='financialEntitiesSection' style="display: none;">
								<label>#springMessage("data.financialEntity")</label>
								<div>
									#multiselect("financialEntities", $!userProfile.SecuritySettings.FinancialEntities, $financialEntityNames, $financialEntityIds)
								</div>
							</section>

							<section>
								<label>#springMessage("data.userManager")</label>
								<div>
									#select("userManager", $!userProfile.SecuritySettings.UserManager, $svh.getBooleanNames(${lang}), $svh.BooleanValues)
								</div>
							</section>

							<section>
								<label>#springMessage("data.tableManager")</label>
								<div>
									#select("tableManager", $!userProfile.SecuritySettings.TableManager, $svh.getBooleanNames(${lang}), $svh.BooleanValues)
								</div>
							</section>

							<section>
								<div>
								#if( $canwrite == true )
									<button class="fr submit">#springMessage("app.button.submit")</button>
								#else
									<button class="fr" onclick="window.location='/main-be/userList';" >#springMessage("app.button.back")</button>
								#end
								</div>
							</section>

							<section>
								<div id="permissionsFormMsg"></div>
							</section>

						</fieldset>
					</form>
				</div>

				<!-- Audit -->
				<div>
					<form id="policiesForm" autocomplete="off">
						<fieldset>
							<input type="hidden" id="offerid" value="$offer.Identifier">
							<label style="height: 30px;">
								#springMessage("app.audit")
							</label>

							<section>
								<label for="creationDateTime">#springMessage("app.audit.creationDateTime")</label>
								<div>
									$svh.formatDate($userProfile.creationDateTime) - $svh.formatTime($userProfile.creationDateTime)
								</div>
							</section>

							<section>
								<label for="lastUpdate">#springMessage("app.audit.lastUpdate")</label>
								<div>
									$svh.formatDate($userProfile.lastUpdate) - $svh.formatTime($userProfile.lastUpdate)
								</div>
							</section>

							<section>
								<label for="lastUpdate">#springMessage("app.audit.lastLogin")</label>
								<div>
									$svh.formatDate($userProfile.lastLogin) - $svh.formatTime($userProfile.lastLogin)
								</div>
							</section>

							<section>
								<label for="lastUpdate">#springMessage("data.activeInactive")</label>
								<div>
									$svh.formatUserActivityStatus($userProfile.activityStatus)
								</div>
							</section>

							<section>
								<div id="auditFormMsg"></div>
							</section>

						</fieldset>
					</form>
				</div>

				<!-- Map -->
				<div>
					<form id="mapForm" method="post" autocomplete="off">
						<fieldset>
							<input type="hidden" id="userId" value="$userProfile.Identifier" />
							<div id="map"></div>

							<section>
								<div id="mapFormMsg"></div>
							</section>

						</fieldset>
					</form>
					<script>
					setInterval(function() {
						var xhr = $.getJSON('/main-be/getLastUserLocation?userId=$userProfile.Identifier' + '&datetime='+rand());
						xhr.done(loadResults);
					}, 30000);
					
					</script>

				</div>
				
				#end
			</div>
		</div>

	</section>
#parse("includes/footer.vm")
</body>
</html>