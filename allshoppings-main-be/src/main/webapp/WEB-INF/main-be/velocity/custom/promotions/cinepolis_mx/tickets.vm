<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

<title>$!name</title>

<!-- Bootstrap -->
<link href="/main-be/custom-resources/promotions/cinepolis_mx/css/bootstrap.min.css" rel="stylesheet">
<link href="/main-be/custom-resources/promotions/cinepolis_mx/css/bootstrap-select.min.css" rel="stylesheet">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

<!-- 
#0064b2: Azul Cinepolis
 -->

#if($ca.redeemStatus >= 2)
<script>

// Android javascript interface to go back
try {
	if( Android != undefined ) {
		Android.goInvalid();
	}
} catch( exception ) {
	console.log(exception);
}

// iOS javascript interface to go back
function connectWebViewJavascriptBridge(callback) {
	if (window.WebViewJavascriptBridge) {
		callback(WebViewJavascriptBridge)
	} else {
		document.addEventListener('WebViewJavascriptBridgeReady',
				function() {
					callback(WebViewJavascriptBridge)
				}, false)
	}
}

connectWebViewJavascriptBridge(function(bridge) {
	var uniqueId = 1
	bridge.init(function(message, responseCallback) {
		console.log('JS got a message ' + message)
		var data = {
			'Javascript Responds' : 'Wee!'
		}
		console.log('JS responding with ' + data)
		responseCallback(data)
	})

	bridge.registerHandler('testJavascriptHandler', function(data,
			responseCallback) {
		console.log('ObjC called testJavascriptHandler with ' + data)
		var responseData = {
			'Javascript Says' : 'Right back atcha!'
		}
		console.log('JS responding with ' + responseData)
		responseCallback(responseData)
	})

	var data = 'invalidCoupon'
	console.log('JS sending message ' + data)
	bridge.send(data, function(responseData) {
		console.log('JS got response ' + responseData)
	})

})
</script>
#else
 
<style type="text/css">
.hover {
	-webkit-user-select: none;
	-webkit-touch-callout: none;
}

body {
	margin: 0; 
	#if($ca.redeemStatus != 1 && $ca.redeemStatus != 3)
	background-image : url(/main-be/custom-resources/promotions/cinepolis_mx/images/cinepolis-back.png);
	background-color: #0064b2;
	background-position: center;
	background-repeat: no-repeat;
	background-size: 100% 100%;
	#end
}

hr {
	border-style: dashed;
}

a {
	text-decoration: underline;
}

.movieImage {
	width: 45%;
	max-width: 110px;
}

.movieImage2 {
	max-width: 100%;
	max-height: 150px;
}

.container {
	text-align: center;
}

.promotion {
	font-family: Helvetica;
	height: 100vh;
	width: 100%;
	color: white;
}

.redeem {
	font-family: Helvetica;
	height: 100vh;
	width: 100%;
}

.clear-both {
	margin-top: 15px;
	margin-bottom: 15px;
}

.clear-top {
	margin-top: 15px;
}

.clear-bottom {
	margin-bottom: 15px;
}

.btn-ghost {
	background: transparent;
	color: #F2F2F2;
	/* CSS Transition */
	-webkit-transition: background .2s ease-in-out, border .2s ease-in-out;
	-moz-transition: background .2s ease-in-out, border .2s ease-in-out;
	-ms-transition: background .2s ease-in-out, border .2s ease-in-out;
	-o-transition: background .2s ease-in-out, border .2s ease-in-out;
	transition: background .2s ease-in-out, border .2s ease-in-out;
}

.modal {
	max-width: 400px;
	margin-left: auto;
	margin-right: auto;
}

.modal-backdrop {
	position: fixed;
	top: 0;
	right: 0;
	bottom: 0;
	left: 0;
	z-index: 1040;
	background-color: #487aa4;
}

#btn-primary {
	background-color: #487aa4;
}

.blue {
	color: #487aa4;
}

.modal-header {
	border-bottom: none;
}

.modal-footer {
	border-top: none;
}

.modal-body {
	padding-top: 0;
	padding-bottom: 0;
}

.no-padding-right {
	padding-right: 0;
}

.bar-code {
	height: 60px;
	width: 100%;
	max-width: 200px;
}

.big {
	margin-top: -10px;
	font-size: 36px;
	font-weight: bolder;
}

#header {
	padding-top: 12px;
	background-color: #ffcc03;
	color: #0064b2;
}

.small-padding {
	padding-left: 10px;
	padding-right: 10px;
}

.rate {
	background-color: #aaaaaa;
	padding: 3px 5px;
	border-radius: 3px;
}

.duration {
	background-color: #000;
	padding: 3px 5px;
	border-radius: 3px;
	color: #fff;
}

.movie-gender {
	background-color: #ccc;
	padding: 3px 5px;
	border-radius: 3px;
	color: #000;
}

.btn {
	width: 100%;
	height: 40px;
	font-size: 16px;
}

.min-clear {
	margin-top: 5px;
	margin-bottom: 5px;
}

.small-text {
	font-size: 12px;
}

.small-inter {
	line-height: 1.3;
	padding-bottom: 5px;
}

.small-font {
	font-size: 13px
}

.mini-font {
	font-size: 10px
}

.mini2-font {
	font-size: 11px
}

.call-to-action {
	margin-top: 30px;
	font-size: 18px;
}

.movie-title {
	font-size: 16px;
}

.gray {
	color: #7f7f7f;
}

.solid {
	border-style: solid;
	margin-top: 5px;
	margin-bottom: 5px;
}

#promotion-portrait {
	display: none;
}

#promotion-landscape {
	display: none;
}

#coupon-count {
	width: 100%;
}

.bootstrap-select {
	width: 100% !important;
}

.dark {
	color: #555;
}

.black {
	color: #000;
}

.img-minus {
	background-image:
		url(/main-be/custom-resources/promotions/cinepolis_mx/images/minus.png);
	background-position: center;
	background-repeat: no-repeat;
	background-size: 60px;
	height: 60px;
	width: 100%;
}

.img-minus_hover {
	background-image:
		url(/main-be/custom-resources/promotions/cinepolis_mx/images/minus-pressed.png);
}

.img-plus {
	background-image:
		url(/main-be/custom-resources/promotions/cinepolis_mx/images/plus.png);
	background-position: center;
	background-repeat: no-repeat;
	background-size: 60px;
	height: 60px;
	width: 100%;
}

.img-plus_hover {
	background-image:
		url(/main-be/custom-resources/promotions/cinepolis_mx/images/plus-pressed.png);
}

.loader {
	height: 100vh;
	width: 100%;
	background-color: #4e555b;
	background-image:
		url(/main-be/custom-resources/promotions/cinepolis_mx/images/loader.png);
	background-position: center;
	background-repeat: no-repeat;
	background-size: 150px;
}

@media ( max-width : 500px) {
	.small-text {
		font-size: 10px;
	}
	.small-inter {
		line-height: 1.1;
		padding-bottom: 5px;
	}
	.small-font {
		font-size: 13px
	}
	.call-to-action {
		margin-top: 30px;
		font-size: 18px;
	}
	.small-padding {
		padding-left: 5px;
		padding-right: 5px;
	}
}

@media ( min-width : 600px) {
	.blue {
		font-size: 17px;
	}
	
	.small-text {
		font-size: 13px;
	}
	.small-inter {
		line-height: 1.1;
		padding-bottom: 5px;
	}
	.small-font {
		font-size: 16px
	}
}
</style>

</head>
<body>

	<!-- Loader Block ----------------------------------------------------------->

	<div id="loader-container" class="container loader" style="display: none;">
	</div>

	<!-- Loader Block ----------------------------------------------------------->

	<!-- Promotion Block ----------------------------------------------------------->

	<div id="promotion-container" class="container promotion"  #if($ca.redeemStatus == 1 || $ca.redeemStatus == 3) style="display: none;" #end >
		<div id="header" class="row">
			<p><strong>&iexcl;PROMOCI&Oacute;N DE &Uacute;LTIMO MINUTO!</strong></p>
		</div>

		<!-- Promotion Block Portrait ----------------------------------------------------------->
		<div id="promotion-portrait">
			<div class="row clear-top">
				<img class="movieImage" src="/img/$!avatarId?width=300" />
			</div>
	
			<div class="row">
				<p>
					<div class="movie-title">$!name $!format</div>
					<div class="small-inter min-clear">
						<span class="rate small-font">$!rate</span>
						<span class="duration small-font">$!length</span> 
						<span class="movie-gender small-font">$movieGender</span>
					</div>
					<div class="small-inter small-font">$!cinema - $!screen</div>
					<div class="small-inter mini2-font"><strong>$!showDateTime</strong></div>
					<div class="small-inter small-font">Podr&aacute;s adquirir hasta 3 entradas de adulto</div>
					<div class="small-inter small-font">Precio especial: $!price <span class="mini-font">(IVA incluido)</span> por boleto</div>
				</p>
			</div>
		</div>
		<!-- Promotion Block Portrait ----------------------------------------------------------->

		<!-- Promotion Block Landscape ----------------------------------------------------------->
		<div id="promotion-landscape">
			<div class="row clear-both">
				<div class="col-xs-3 no-padding-right">
					<img class="movieImage2"
						src="/img/$!avatarId?width=300" />
				</div>
				<div class="col-xs-9 text-left" class="small-padding">
	
					<div class="movie-title small-inter">$!name $!format</div>
					<div class="small-inter min-clear">
						<span class="rate small-font">$!rate</span>
						<span class="duration small-font">$!length</span> 
						<span class="movie-gender small-font">$movieGender</span>
					</div>
					<div class="small-inter small-font">$!cinema - $!screen</div>
					<div class="small-inter mini2-font"><strong>$!showDateTime</strong></div>
					<div class="small-inter small-font">Podr&aacute;s adquirir hasta 3 entradas de adulto</div>
					<div class="small-inter small-font">Precio especial: $!price <span class="mini-font">(IVA incluido)</span> por boleto</div>
				</div>
			</div>
		</div>
		<!-- Promotion Block Landscape ----------------------------------------------------------->
		
		#if( $ca.redeemStatus == 0 )
		<div class="row clear-top">
			<p class="question"><strong class="call-to-action">&iexcl;No te pierdas esta oferta limitada!</strong></p>
		</div>

		<div id="last-rows" class="row clear-bottom">
			<div class="col-xs-6 col-md-6">
				<button id="accept-button" type="button" class="btn btn-default btn-ghost">La quiero</button>
			</div>
			<div class="col-xs-6 col-md-6">
				<button id="reject-button" type="button" class="btn btn-default btn-ghost">No, gracias</button>
			</div>
		</div>
		#end
		<br/>
	</div>

	<!-- Promotion Block ----------------------------------------------------------->

	<!-- Redemed Block ------------------------------------------------------------->

	<div id="redeem-container" class="container redeem" #if($ca.redeemStatus != 1 && $ca.redeemStatus != 3) style="display: none;" #end >
		<div id="header" class="row">
			<p><strong>&iexcl;PROMOCI&Oacute;N DE &Uacute;LTIMO MINUTO!</strong></p>
		</div>
		<div class="row clear-both">
			<div class="col-xs-3 no-padding-right">
				<img class="movieImage2" src="/img/$!avatarId?width=300" />
			</div>
			<div class="col-xs-9 small-padding text-left">
				<div class="blue">$!name $!format</div>
				<div class="small-inter min-clear">
					<span class="rate small-font">$!rate</span>
					<span class="duration small-font">$!length</span> 
					<span class="movie-gender small-font">$movieGender</span>
				</div>
				<div class="small-inter small-font black">$!cinema, $!screen</div>
				<div class="small-inter mini2-font"><strong>$!showDateTime</strong></div>
				<div class="small-inter small-font dark">Hasta 3 entradas de adulto</div>
			</div>
		</div>

		<div class="row clear-bottom">
			<div class="col-xs-12 blue" style="font-size: 12px;">Presenta estos folios promocionales en Taquilla</div>
			<div class="col-xs-12 blue"><strong>
				Precio especial: $!price IVA incluido <br/> por entrada.
				</strong>
			</div>
		</div>

		<!-- Ticket 1 ------------------------------------------------------------------------------------------------>
		<div id="ticket-1">
			<hr>
			<div class="row">
				<div class="col-xs-12">
					<img id="bar-code1" class="bar-code" src="/barcode/$!couponCode1" />
				</div>
			</div>
	
			<div class="row clear-bottom">
				<div class="col-xs-12"><strong>C&Oacute;DIGO DE LA PROMOCI&Oacute;N</strong></div>
				<div class="col-xs-12 big" ID="couponCode1">$!couponCode1</div>
			</div>
		</div>

		<!-- Ticket 2 ------------------------------------------------------------------------------------------------>
		<div id="ticket-2">
			<hr>
			<div class="row">
				<div class="col-xs-12">
					<img id="bar-code2" class="bar-code" src="/barcode/$!couponCode2" />
				</div>
			</div>
	
			<div class="row clear-bottom">
				<div class="col-xs-12"><strong>C&Oacute;DIGO DE LA PROMOCI&Oacute;N</strong></div>
				<div class="col-xs-12 big" ID="couponCode2">$!couponCode2</div>
			</div>
		</div>

		<!-- Ticket 3 ------------------------------------------------------------------------------------------------>
		<div id="ticket-3">
			<hr>
			<div class="row">
				<div class="col-xs-12">
					<img id="bar-code3" class="bar-code" src="/barcode/$!couponCode3" />
				</div>
			</div>
	
			<div class="row clear-bottom">
				<div class="col-xs-12"><strong>C&Oacute;DIGO DE LA PROMOCI&Oacute;N</strong></div>
				<div class="col-xs-12 big" ID="couponCode3">$!couponCode3</div>
			</div>
		</div>

		<!-- Policies ------------------------------------------------------------------------------------------------>
		<hr>
		<div class="row text-center clear-bottom">
			<div class="col-xs-12">
				<div class="small-text">
					La promoci&oacute;n est&aacute; sujeta a disponibilidad y aplica para las primeras $!availableSeats personas en canjear su c&oacute;digo en taquilla. 
				</div>
				<div class="small-text clear-top">
					<a href="#" id="ticket-to-tos">Aplican Condiciones y Restricciones</a>
					<br/><br/> 
				</div>
			</div>
		</div>
	</div>

	<!-- Redemed Block ------------------------------------------------------------->

	<!-- Terms And Conditions Block ------------------------------------------------>

	<div id="tos-container" class="container redeem" style="display: none;">
		<div id="header" class="row">
			<p><strong>CONDICIONES Y RESTRICCIONES</strong></p>
		</div>
		<div class="row clear-both">
			<div class="col-xs-12 text-left">
				<p>
					Esta promoci&oacute;n est&aacute; <span
						style="text-decoration: underline;">sujeta a
						disponibilidad, hasta agotarse los $!availableSeats boletos en las
						taquillas del cine.</span>
				</p>
				<p>
					Muestra en la taquilla del cine el o los c&oacute;digos de la
					promoci&oacute;n que se visualizan en la pantalla anterior y <span
						style="text-decoration: underline;">podr&aacute;s obtener
						por cada c&oacute;digo un boleto de entrada al cine &uacute;nica y
						exclusivamente para la funci&oacute;n, fecha y horario descrito,
						al precio especial indicado.</span>
				</p>
				<p>El o los c&oacute;digos s&oacute;lo ser&aacute;n v&aacute;lidos en
					el conjunto Cin&eacute;polis se&ntilde;alado.</p>
				<p>Por cada c&oacute;digo, se podr&aacute; canjear s&oacute;lo un
					boleto de entrada al precio especial, se podr&aacute;n generar
					hasta 3 c&oacute;digos.</p>
				<p>El o los c&oacute;digos deben mostrarse completos y legibles
					para que puedan ser reconocidos por el sistema.</p>
				<p>El o los c&oacute;digos s&oacute;lo ser&aacute;n v&aacute;lidos una
					sola vez, para el cliente que los porte.</p>
				<p>No aplica con otras promociones, ni en premieres, funciones
					especiales o contenido alternativo.</p>
				<p>No aplica en reservaciones por Cineticket, o venta avanzada,
					taquillas autom&aacute;ticas u otros medios no especificados.</p>
				<p>
					Promoci&oacute;n administrada por Cin&eacute;polis de
					M&eacute;xico, S.A. de C.V. Tel&eacute;fono para informaci&oacute;n
					y aclaraciones 01 800 120 02 20, <strong>contacto@cinepolis.com</strong>
				</p>
				<p class="text-center">
					<a href="#" id="tos-to-ticket">Volver a la promoci&oacute;n</a>
				</p>
			</div>
		</div>
	</div>

	<!-- Terms And Conditions Block ------------------------------------------------>

	<!-- Modal rejection motives window -------------------------------------------->

	<div id="reject-modal" class="modal fade" style="top: 15vh;" >
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<strong style="color: #487aa4;">&iquest;Por qu&eacute; no la quieres?</strong>
				</div>
				<div class="modal-body">
					<form role="form">
						<div class="checkbox">
							<label><input type="checkbox" id="negoption1" value="">Ya compr&eacute;</label>
						</div>
						<div class="checkbox">
							<label><input type="checkbox" id="negoption2" value="">Tengo otros planes</label>
						</div>
						<div class="checkbox">
							<label><input type="checkbox" id="negoption3" value="">No me gusta la pel&iacute;cula</label>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button id="send-comments" type="button" class="btn btn-primary" style="width: 100%;" data-dismiss="modal">Enviar</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal rejection motives window -------------------------------------------->

	<!-- Modal tickets count window ------------------------------------------------>

	<div id="tickets-modal" class="modal fade" style="top: 5vh;" >
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<strong style="color: #487aa4;">Necesito...</strong>
					<hr class="gray solid"/>
				</div>
				<div class="modal-body">
					<div class="text-center" style="height: 70px;">
						<div style="width: 33%; float: left; text-align: center;">
							<a id="btn-minus" href="#"><div class="img-minus"></div></a>
						</div>
						<div style="width: 33%; float: left; text-align: center;">
							<h1 id="coupon-count-text" class="gray" style="margin: 0px; font-size: 50px;">2</h1>
						</div>
						<div style="width: 33%; float: right; text-align: center;">
							<a id="btn-plus" href="#"><div class="img-plus"></div></a>
						</div>
						<input type="hidden" id="coupon-count" value="2"/>
					</div>
					<div class="text-center gray" style="margin-top: 10px;">Entradas a precio especial</div>
				</div>
				<div class="modal-footer">
					<hr class="gray solid"/>
					<div class="small-text text-center gray" style="margin-top: 10px; margin-bottom: 20px;">Recuerda que puedes seleccionar hasta 3 entradas.</div>
					<button id="send-tickets" type="button" class="btn btn-default btn-ghost gray" style="width: 100%;" data-dismiss="modal">Aceptar</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal tickets count window ------------------------------------------------>

	<!-- Modal timeout window ------------------------------------------------------>

	<div id="timeout-modal" class="modal fade" style="top: 5vh;" >
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<strong style="color: #487aa4;">No hay conexi&oacute;n...</strong>
					<hr class="gray solid"/>
				</div>
				<div class="modal-body">
					<div class="text-center gray" style="margin-top: 10px;">&iquest;Deseas reintentar la operaci&oacute;n?</div>
				</div>
				<div class="modal-footer">
					<hr class="gray solid"/>
					<div class="col-xs-6 col-md-6">
						<button id="retry-button" type="button" class="btn btn-default">Reintentar</button>
					</div>
					<div class="col-xs-6 col-md-6">
						<button id="cancel-button" type="button" class="btn btn-default">No, gracias</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal timeout window ------------------------------------------------------>

	<!-- Modal expired window ------------------------------------------------------>

	<div id="expired-modal" class="modal fade" style="top: 5vh;" >
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<strong style="color: #487aa4;">Lo sentimos...</strong>
					<hr class="gray solid"/>
				</div>
				<div class="modal-body">
					<div class="text-center gray" style="margin-top: 10px;">La promoci&oacute;n ha expirado</div>
				</div>
				<div class="modal-footer">
					<hr class="gray solid"/>
					<button id="cancel2-button" type="button" class="btn btn-default btn-ghost gray" style="width: 100%;" data-dismiss="modal">Volver</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal expired window ------------------------------------------------------>

	<!-- Silly window to get images loaded ----------------------------------------->

	<div style="display: none;">
		<img src="/main-be/custom-resources/promotions/cinepolis_mx/images/minus.png"/>
		<img src="/main-be/custom-resources/promotions/cinepolis_mx/images/plus.png"/>
		<img src="/main-be/custom-resources/promotions/cinepolis_mx/images/minus-pressed.png"/>
		<img src="/main-be/custom-resources/promotions/cinepolis_mx/images/plus-pressed.png"/>
	</div>

	<!-- Silly window to get images loaded ----------------------------------------->

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="/main-be/custom-resources/promotions/cinepolis_mx/js/bootstrap.min.js"></script>
	<script src="/main-be/custom-resources/promotions/cinepolis_mx/js/bootstrap-select.min.js"></script>
	<script src="/main-be/custom-resources/promotions/cinepolis_mx/js/fastclick.js"></script>
	<!-- Custom scripts -->
	<script>

		FastClick.attach(document.body);

		$(window).resize(function() {
			windowResized();
		});

		$(window).load(function() {
			windowResized();
		});
		
		windowResized = function() {
			var mq = window.matchMedia("(max-width: 500px)");
			if (mq.matches) {
				// Window is portrait
				$('#promotion-portrait').css('display', 'block');
				$('#promotion-landscape').css('display', 'none');
			} else {
				// window is landscape
				$('#promotion-portrait').css('display', 'none');
				$('#promotion-landscape').css('display', 'block');
			}

			if(1 == $!couponCount) {
				$('#ticket-1').css('display', 'block');
				$('#ticket-2').css('display', 'none');
				$('#ticket-3').css('display', 'none');
			}
			if(2 == $!couponCount) {
				$('#ticket-1').css('display', 'block');
				$('#ticket-2').css('display', 'block');
				$('#ticket-3').css('display', 'none');
			}
			if(3 == $!couponCount) {
				$('#ticket-1').css('display', 'block');
				$('#ticket-2').css('display', 'block');
				$('#ticket-3').css('display', 'block');
			}
		}

	    $('#btn-minus').bind('touchstart', function(e) {
	        $(".img-minus").addClass('img-minus_hover');
	    });

	    $('#btn-plus').bind('touchstart', function(e) {
	        $(".img-plus").addClass('img-plus_hover');
	    });

		$('#btn-minus').click(function(e) {
			e.preventDefault();
	        $(".img-minus").addClass('img-minus_hover');
			couponCount = $('#coupon-count').val();
			if( couponCount > 1 ) couponCount--;
			$('#coupon-count').val(couponCount);
			$('#coupon-count-text').html(couponCount);
			setTimeout(function(){ $(".img-minus").removeClass('img-minus_hover'); }, 200);
		});
		
		$('#btn-plus').click(function(e) {
			e.preventDefault();
	        $(".img-plus").addClass('img-plus_hover');
			couponCount = $('#coupon-count').val();
			if( couponCount < 3 ) couponCount++;
			$('#coupon-count').val(couponCount);
			$('#coupon-count-text').html(couponCount);
			setTimeout(function(){ $(".img-plus").removeClass('img-plus_hover'); }, 200);
		});
		
		$('#retry-button').click(function() {
			$("#timeout-modal").modal('hide');
			$('#send-tickets').trigger('click');
		});
		
		$('#cancel-button').click(function() {
			$('#last-rows').fadeOut();
			$('.question').fadeOut();
			$("#timeout-modal").modal('hide');
			// Android javascript interface to go back
			try {
				if( Android != undefined ) {
					Android.goBack();
				}
			} catch( exception ) {
				console.log(exception);
			}
		});
		
		$('#cancel2-button').click(function() {
			$('#last-rows').fadeOut();
			$('.question').fadeOut();
			$("#expired-modal").modal('hide');
			// Android javascript interface to go back
			try {
				if( Android != undefined ) {
					Android.goBack();
				}
			} catch( exception ) {
				console.log(exception);
			}
		});
		
		$('#reject-button').click(function() {
			$("#reject-modal").modal('show');
		});

		$('#ticket-to-tos').click(function() {
			$('#redeem-container').css('display', 'none');
			$('#tos-container').css('display', 'block');
			$('body').scrollTop( 0 );
		});

		$('#tos-to-ticket').click(function() {
			$('#tos-container').css('display', 'none');
			$('#redeem-container').css('display', 'block');
			$('body').scrollTop( 0 );
		});

		$('#accept-button').click(function() {
			$("#tickets-modal").modal('show');
			return;
		});

		$('#send-tickets').click(function() {
			$("#tickets-modal").modal('hide');
			parms = {
				couponCount : $('#coupon-count').val(),
				method : 'post'
			};

			$("#promotion-container").fadeOut(400, function() {
				$("body").css("background", "#4e555b");
				$("#loader-container").fadeIn();
			
				$.ajax({
					crossDomain : true,
					headers : {
						"Content-Type" : "application/json; charset=UTF-8"
					},
					dataType : "json",
					data : JSON.stringify(parms),
					type : "post",
					url : '/appv2/coupons/$!ca.identifier?authToken=$!app',
					timeout : 10000,
					success : function(data) {
						$('body').scrollTop( 0 );
						console.log(JSON.stringify(data));
						
						if( data.error_code ) {
							$('#expired-modal').modal('show');
						} else {
							
							if($('#coupon-count').val() == 1) {
								$('#ticket-1').css('display', 'block');
								$('#ticket-2').css('display', 'none');
								$('#ticket-3').css('display', 'none');
							}
							if($('#coupon-count').val() == 2) {
								$('#ticket-1').css('display', 'block');
								$('#ticket-2').css('display', 'block');
								$('#ticket-3').css('display', 'none');
							}
							if($('#coupon-count').val() == 3) {
								$('#ticket-1').css('display', 'block');
								$('#ticket-2').css('display', 'block');
								$('#ticket-3').css('display', 'block');
							}
							$("#couponCode1").html(data.couponCode);
							$("#couponCode2").html(data.extraCoupon1);
							$("#couponCode3").html(data.extraCoupon2);
							$("#bar-code1").attr('src', '/barcode/' + data.couponCode);
							$("#bar-code2").attr('src', '/barcode/' + data.extraCoupon1);
							$("#bar-code3").attr('src', '/barcode/' + data.extraCoupon2);
							$("#loader-container").fadeOut(400, function() {
								$("body").css("background", "white");
								$("#redeem-container").fadeIn();
								$("body").css("background", "white");
							});
							
						}
					},
					error : function(data, t, m) {
						$("#timeout-modal").modal('show');
					},
				});
			});
		});

		$('#send-comments').click(function() {
			$('#last-rows').fadeOut();
			$('.question').fadeOut();
			var rejectionMotives = '';
			if ($('#negoption1').is(':checked'))
				rejectionMotives += '0,';
			if ($('#negoption2').is(':checked'))
				rejectionMotives += '1,';
			if ($('#negoption3').is(':checked'))
				rejectionMotives += '3,';
			parms = {
				rejectionMotives : rejectionMotives,
				method : 'delete'
			};
			$.ajax({
				crossDomain : true,
				headers : {
					"Content-Type" : "application/json; charset=UTF-8"
				},
				dataType : "json",
				data : JSON.stringify(parms),
				type : "post",
				url : '/appv2/coupons/$!ca.identifier?authToken=$!app',
				success : function(data) {
					console.log(JSON.stringify(data));
				},
			});
			
			// Android javascript interface to go back
			try {
				if( Android != undefined ) {
					Android.goBack();
				}
			} catch( exception ) {
				console.log(exception);
			}
		})

		// iOS javascript interface to go back
		function connectWebViewJavascriptBridge(callback) {
			if (window.WebViewJavascriptBridge) {
				callback(WebViewJavascriptBridge)
			} else {
				document.addEventListener('WebViewJavascriptBridgeReady',
						function() {
							callback(WebViewJavascriptBridge)
						}, false)
			}
		}

		connectWebViewJavascriptBridge(function(bridge) {
			var uniqueId = 1
			bridge.init(function(message, responseCallback) {
				console.log('JS got a message ' + message)
				var data = {
					'Javascript Responds' : 'Wee!'
				}
				console.log('JS responding with ' + data)
				responseCallback(data)
			})

			bridge.registerHandler('testJavascriptHandler', function(data,
					responseCallback) {
				console.log('ObjC called testJavascriptHandler with ' + data)
				var responseData = {
					'Javascript Says' : 'Right back atcha!'
				}
				console.log('JS responding with ' + responseData)
				responseCallback(responseData)
			})

			var button = document.getElementById('send-comments');
			button.onclick = function(e) {
				e.preventDefault()
				$('#last-rows').fadeOut();
				$('#question').fadeOut();
				var rejectionMotives = '';
				if ($('#negoption1').is(':checked'))
					rejectionMotives += '0,';
				if ($('#negoption2').is(':checked'))
					rejectionMotives += '1,';
				if ($('#negoption3').is(':checked'))
					rejectionMotives += '3,';
				parms = {
					rejectionMotives : rejectionMotives,
					method : 'delete'
				};
				$.ajax({
					crossDomain : true,
					headers : {
						"Content-Type" : "application/json; charset=UTF-8"
					},
					dataType : "json",
					data : JSON.stringify(parms),
					type : "post",
					url : '/appv2/coupons/$!ca.identifier?authToken=$!app',
					success : function(data) {
						console.log(JSON.stringify(data));
					},
				});
				var data = 'commentsSent'
				console.log('JS sending message ' + data)
				bridge.send(data, function(responseData) {
					console.log('JS got response ' + responseData)
				})
			}

			var button2 = document.getElementById('cancel-button');
			button2.onclick = function(e) {
					$('#last-rows').fadeOut();
					$('.question').fadeOut();
					$("#timeout-modal").modal('hide');
					var data = 'commentsSent'
						console.log('JS sending message ' + data)
						bridge.send(data, function(responseData) {
							console.log('JS got response ' + responseData)
						});
			};

			var button3 = document.getElementById('cancel2-button');
			button3.onclick = function(e) {
					$('#last-rows').fadeOut();
					$('.question').fadeOut();
					$("#expired-modal").modal('hide');
					var data = 'commentsSent'
						console.log('JS sending message ' + data)
						bridge.send(data, function(responseData) {
							console.log('JS got response ' + responseData)
						});
			};
})
	</script>
</body>
#end
</html>
